<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>State production | Türkçe Android Dokümantasyonu</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="State production" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Android Dokümantasyonu Türkçe Çeviri Projesi" /> <meta property="og:description" content="Android Dokümantasyonu Türkçe Çeviri Projesi" /> <link rel="canonical" href="http://localhost:4000/docs/app-architecture/guide-to-app-architecture/ui-layer/state-production.html" /> <meta property="og:url" content="http://localhost:4000/docs/app-architecture/guide-to-app-architecture/ui-layer/state-production.html" /> <meta property="og:site_name" content="Türkçe Android Dokümantasyonu" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="State production" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Android Dokümantasyonu Türkçe Çeviri Projesi","headline":"State production","url":"http://localhost:4000/docs/app-architecture/guide-to-app-architecture/ui-layer/state-production.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Türkçe Android Dokümantasyonu </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Ana Sayfa</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in App basics category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-basics" class="nav-list-link">App basics</a><ul class="nav-list"><li class="nav-list-item "><a href="/docs/app-basics/build-your-first-app.html" class="nav-list-link">Build Your First App</a></li><li class="nav-list-item "><a href="/docs/app-basics/app-fundamentals.html" class="nav-list-link">App fundamentals</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App resources category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-basics/app-resources/app-resources.html" class="nav-list-link">App resources</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/about-app-resources.html" class="nav-list-link">About app resources</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/handle-configuration-changes.html" class="nav-list-link">Handle configuration changes</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/localization/localization.html" class="nav-list-link">Localization</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/complex-xml-resources.html" class="nav-list-link">Complex XML resources</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/resource-types/resource-types.html" class="nav-list-link">Resource types</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App manifest file category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-basics/app-manifest-file/app-manifest-file.html" class="nav-list-link">App manifest file</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/about-app-manifests.html" class="nav-list-link">About app manifests</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/action.html" class="nav-list-link">action</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/activity.html" class="nav-list-link">activity</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/activity-alias.html" class="nav-list-link">action</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/application.html" class="nav-list-link">application</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/category.html" class="nav-list-link">category</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/compatible-screens.html" class="nav-list-link">action</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/data.html" class="nav-list-link">data</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/grant-uri-permission.html" class="nav-list-link">grant-uri-permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/instrumentation.html" class="nav-list-link">instrumentation</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/intent-filter.html" class="nav-list-link">intent-filter</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/layout.html" class="nav-list-link">layout</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/manifest.html" class="nav-list-link">manifest</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/meta-data.html" class="nav-list-link">meta-data</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/path-permission.html" class="nav-list-link">path-permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/permission.html" class="nav-list-link">permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/permission-group.html" class="nav-list-link">permission-group</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/permission-tree.html" class="nav-list-link">permission tree</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/property.html" class="nav-list-link">property</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/receiver.html" class="nav-list-link">receiver</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/service.html" class="nav-list-link">service</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/supports-gl-texture.html" class="nav-list-link">supports-gl-texture</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/supports-screens.html" class="nav-list-link">supports-screens</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-configuration.html" class="nav-list-link">uses-configuration</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-feature.html" class="nav-list-link">manifest</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-library.html" class="nav-list-link">uses-library</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-native-library.html" class="nav-list-link">uses-native-library</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-permission.html" class="nav-list-link">uses-permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-permission-sdk-23.html" class="nav-list-link">uses-permission-sdk-23</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-sdk.html" class="nav-list-link">uses-sdk</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in App architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture" class="nav-list-link">App architecture</a><ul class="nav-list"><li class="nav-list-item "><a href="/docs/app-architecture/introduction.html" class="nav-list-link">Introduction</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Guide to app architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/guide-to-app-architecture/guide-to-app-architecture.html" class="nav-list-link">Guide to app architecture</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/about-app-architecture.html" class="nav-list-link">About app architecture</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/ui-layer/ui-layer.html" class="nav-list-link">Ui layer</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/domain-layer.html" class="nav-list-link">Domain layer</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/data-layer/data-layer.html" class="nav-list-link">Data layer</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/architecture-recommendatios.html" class="nav-list-link">Architecture recommendations</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/learning-pathway.html" class="nav-list-link">Learning pathway</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Modularization category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/modularization/modularization.html" class="nav-list-link">Modularization</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/modularization/about-modularization.html" class="nav-list-link">About modularization</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/modularization/common-patterns.html" class="nav-list-link">Common patterns</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/modularization/recipes.html" class="nav-list-link">Recipes</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Architecture components category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/architecture-components/architecture-components.html" class="nav-list-link">Architecture components</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/architecture-components/ui-layer-libraries/ui-layer-libraries.html" class="nav-list-link">UI layer libraries</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/architecture-components/data-layer-libraries/data-layer-libraries.html" class="nav-list-link">Data layer libraries</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App entry points category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/app-entry-points/app-entry-points.html" class="nav-list-link">App entry points</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/app-entry-points/activities/activities.html" class="nav-list-link">Activities</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-entry-points/app-shortcuts/app-shortcuts.html" class="nav-list-link">App shortcuts</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App navigation category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/app-navigation/app-navigation.html" class="nav-list-link">App navigation</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/principles-of-navigation.html" class="nav-list-link">Principles of navigation</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/design-for-different-form-factors.html" class="nav-list-link">Design for different form factors</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/handle-configuration-changes.html" class="nav-list-link">Handle configuration changes</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/navigation-component/navigation-component.html" class="nav-list-link">Navigation component</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/fragments/fragments.html" class="nav-list-link">Fragments</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/app-links/app-links.html" class="nav-list-link">App links</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/create-swipe-views-with-tabs-using-viewpager.html" class="nav-list-link">Create swipe views with tabs using ViewPager</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/create-swipe-views-with-tabs-using-viewpager2.html" class="nav-list-link">Create swipe views with tabs using ViewPager2</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/add-support-for-back-navigation/add-support-for-back-navigation.html" class="nav-list-link">Add support for back navigation</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Dependency Injection category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/dependency-injection/dependency-injection.html" class="nav-list-link">Dependency Injection</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/about-dependency-injection.html" class="nav-list-link">About dependency injection</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/manual-dependency-injection.html" class="nav-list-link">Manual dependency injection</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/dependency-injetion-with-hilt.html" class="nav-list-link">Dependency injection with Hilt</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/hilt-in-multi-module-apps.html" class="nav-list-link">Hilt in multi-module apps</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/use-hilt-with-other-jetpack-libraries.html" class="nav-list-link">Use Hilt with other Jetpack libraries</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/hilt-testing-guide.html" class="nav-list-link">Hilt testing guide</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/hilt-and-dagger-annotations-cheat-sheet.html" class="nav-list-link">Hilt and Dagger annotations cheat sheet</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/dagger/dagger.html" class="nav-list-link">Dagger</a> </li></ul></li><li class="nav-list-item "><a href="/docs/app-architecture/app-startup.html" class="nav-list-link">App startup</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Core topics category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/core-topics" class="nav-list-link">Core topics</a><ul class="nav-list"></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Best practices category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/best-practices" class="nav-list-link">Best practices</a><ul class="nav-list"></ul></li></ul> </nav> <footer class="site-footer"> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Ara" aria-label="Ara" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Guide to app architecture</a></li> <li class="breadcrumb-nav-list-item"><a href="">Ui layer</a></li> <li class="breadcrumb-nav-list-item"><span>State production</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="state-production"> <a href="#state-production" class="anchor-heading" aria-labelledby="state-production"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State production </h1> <h2 id="ui-state-production"> <a href="#ui-state-production" class="anchor-heading" aria-labelledby="ui-state-production"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> UI State Production </h2> <p>Modern UI ler nadiren statiktir. Kullanıcı, UI ile etkileşime girdiğinde veya uygulamanın yeni verileri göstermesi gerektiğinde UI’in state’i değişir. Bu belge, UI state’inin üretimi(production) ve yönetimi için yönergeler belirler. Sonunda şunları yapmalısınız:</p> <ul> <li>UI state’i oluşturmak(produce) için hangi API’leri kullanmanız gerektiğini bilin. Bu, <a href="about-the-ui-layer.md#manage-state-with-undirectional-data-flow">tek yönlü veri akışı(UDF)</a> ilkelerini izleyerek state holderlerinizde bulunan state değişikliği kaynaklarının doğasına bağlıdır.</li> <li>Sistem kaynaklarının bilincinde olmak için UI state’inin üretimini nasıl kapsamanız(scope) gerektiğini öğrenin.</li> <li>UI tarafından tüketim için UI stateini nasıl ortaya çıkarmanız gerektiğini bilin.</li> </ul> <p>Temel olarak state üretimi(state production), bu değişikliklerin UI state’ine artımlı olarak uygulanmasıdır. State her zaman vardır ve eventler sonucunda değişir. Eventler ve state arasındaki farklar aşağıdaki tabloda özetlenmiştir:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Event</th> <th>State</th> </tr> </thead> <tbody> <tr> <td>Transient, unpredictable, and exist for a finite period.(Geçici, öngörülemeyen ve sonlu bir süre için var olan.)</td> <td>Always exists.(herzaman vardir)</td> </tr> <tr> <td>The inputs of state production.(State üretiminin girdileridir.)</td> <td>The output of state production.(State uretiminin ciktisidir.)</td> </tr> <tr> <td>The product of the UI or other sources.(UI’in veya diğer kaynaklarin urunudur.)</td> <td>Is consumed by the UI.(UI tarafindan tuketilir)</td> </tr> </tbody> </table></div> <p>Yukarıdakileri özetleyen harika bir anımsatıcı şudur: state is; events happen. Aşağıdaki şema, eventler bir zaman çizelgesinde meydana geldikçe statedeki değişiklikleri görselleştirmeye yardımcı olur. Her event uygun state holder tarafından işlenir ve bir state değişikliğiyle sonuçlanır: <img src="/assets/images/state-production-img1.png" alt="Events cause state to change" /></p> <p>Eventler şunlardan gelebilir:</p> <ul> <li>Kullanıcılar: Uygulamanın UI ile etkileşime girdikçe.</li> <li>Diğer state değişikliği kaynakları: UI’den, domainden veya snackbar zaman aşımı eventleri gibi data katmanlarından uygulama verileri sunan API’ler, sırasıyla use case siniflari veya repositoryler.</li> </ul> <h3 id="the-ui-state-production-pipeline"> <a href="#the-ui-state-production-pipeline" class="anchor-heading" aria-labelledby="the-ui-state-production-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The UI state production pipeline </h3> <p>Android uygulamalarındaki state production, aşağıdakilerden oluşan bir processing pipeline olarak düşünülebilir:</p> <ul> <li>Inputs;State’in kaynakları değişir. Olabilirler: <ul> <li>UI katmanında local: Bunlar, bir görev yönetimi uygulamasında “yapılacak iş” için bir başlık giren bir kullanıcı gibi kullanıcı eventleri veya UI state’indeki değişiklikleri yönlendiren <a href="state-holders-and-ui-state.md#ui-logic-and-its-state-holder">UI logic</a>ine erişim sağlayan API’ler olabilir. Örneğin, Jetpack Compose’da <a href="https://developer.android.com/reference/kotlin/androidx/compose/material/DrawerState">DrawerState</a>‘te <a href="https://developer.android.com/reference/kotlin/androidx/compose/material/DrawerState#open()">open</a> methodunu çağırmak.</li> <li>UI katmanının dışında: Bunlar, UI state’inde değişikliklere neden olan domain veya data katmanlarından gelen kaynaklardır. Örneğin, bir NewsRepository’den yüklenmesi biten haberler veya diğer eventler.</li> <li>Yukarıdakilerin hepsinin bir karışımı.</li> </ul> </li> <li><a href="state-holders-and-ui-state.md#state-holders-and-ui-state">State holders</a>;<a href="state-holders-and-ui-state.md#business-logic-and-its-state-holder">Business logic</a>i ve/veya UI logicini state değişikliği kaynaklarına uygulayan ve UI state oluşturmak(produce) için kullanıcı eventlerini işleyen türler.</li> <li>Output;Uygulamanın, kullanıcılara ihtiyaç duydukları bilgileri sağlamak için işleyebileceği UI State.</li> </ul> <p><img src="/assets/images/state-production-img2.png" alt="The state production pipeline" /></p> <h3 id="state-production-apis"> <a href="#state-production-apis" class="anchor-heading" aria-labelledby="state-production-apis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State production APIs </h3> <p>Pipeline’in hangi aşamasında olduğunuza bağlı olarak state productionda kullanılan iki ana API vardır:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Pipeline stage</th> <th>API</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td>You should use asynchronous APIs to perform work off the UI thread to keep the UI jank free. For example, Coroutines or Flows in Kotlin, and RxJava or callbacks in the Java Programming Language.</td> </tr> <tr> <td>Output</td> <td>You should use observable data holder APIs to invalidate and rerender the UI when state changes. For example, StateFlow, Compose State, or LiveData. Observable data holders guarantee the UI always has a UI state to display on the screen.</td> </tr> </tbody> </table></div> <p>Bu ikisi arasından, input için asenkron API seçiminin, output için gözlemlenebilir API seçiminden çok, state production pipelinein doğası üzerinde daha büyük bir etkisi vardır. Bunun nedeni, inputlarin pipeline’a uygulanabilecek processing türünü dikte etmesidir.</p> <h3 id="state-production-pipeline-assembly"> <a href="#state-production-pipeline-assembly" class="anchor-heading" aria-labelledby="state-production-pipeline-assembly"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State production pipeline assembly </h3> <p>Sonraki bölümler, çeşitli inputlar için en uygun state productin tekniklerini ve eşleşen output API’lerini kapsar. Her state production pipelie, inputlarin ve outputlarin bir kombinasyonudur ve şöyle olmalıdır:</p> <ul> <li>Yaşam döngüsünün farkında(Lifecycle aware): UI’in visible veya active olmadığı durumlarda, açıkça gerekli olmadıkça state production pipeline herhangi bir kaynak tüketmemelidir.</li> <li>Kullanımı kolay(Easy to consume): UI, üretilen UI state’ini kolayca oluşturabilmelidir(produce etmelidir). State production pipelinenin outputuna yönelik hususlar, View sistemi veya Jetpack Compose gibi farklı View API’lerinde değişiklik gösterecektir.</li> </ul> <p><mark style="background-color: lightblue">Not: İzleyen bölümlerde, tartışılan tüm API'ler deyimsel Kotlin ve Jetpack Compose kodunu kullanır. Ancak kılavuz, Java Programlama Dili veya Kotlin'deki diğer API'lerdeki eşdeğer analogları için geçerlidir. </mark></p> <h3 id="input-in-state-production-pipelines"> <a href="#input-in-state-production-pipelines" class="anchor-heading" aria-labelledby="input-in-state-production-pipelines"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Input in state production pipelines </h3> <p>Bir state production pipelinedeki inputlar, state değişikliği kaynaklarını şu yollarla sağlayabilir:</p> <ul> <li>One-shot operations that may be synchronous or asynchronous, for example calls to suspend functions.</li> <li>Stream APIs, for example Flows.</li> <li>All of the above.</li> </ul> <p>Aşağıdaki bölümlerde, yukarıdaki inputlarin her biri için bir state production pipline’i nasıl kurabileceğiniz ele alınmaktadır.</p> <h3 id="one-shot-apis-as-sources-of-state-change"> <a href="#one-shot-apis-as-sources-of-state-change" class="anchor-heading" aria-labelledby="one-shot-apis-as-sources-of-state-change"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> One-shot APIs as sources of state change </h3> <p><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-mutable-state-flow/">MutableStateFlow</a> API’yi gözlemlenebilir, değiştirilebilir bir state containeri olarak kullanın. Jetpack Compose uygulamalarında, özellikle <a href="https://medium.com/androiddevelopers/effective-state-management-for-textfield-in-compose-d6e5b070fbe5">Compose text API</a>‘leri ile çalışırken <a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#mutableStateOf(kotlin.Any,androidx.compose.runtime.SnapshotMutationPolicy)">mutableStateOf</a>‘u da düşünebilirsiniz. Her iki API de barındırdıkları değerlerde güvenli atomik güncellemelere izin veren methodlar sunar, güncellemeler senkron veya asenkro olsun ya da olmasın. Örneğin, basit bir zar atma uygulamasında state güncellemelerini düşünün. Kullanıcının attığı her zar, senkronize <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.random/next-int.html">Random.nextInt()</a> methodunu çağırır ve sonuç, UI state’ine yazılır.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// StateFlow</span>
<span class="kd">data class</span> <span class="nc">DiceUiState</span><span class="p">(</span>
        <span class="kd">val</span> <span class="py">firstDieValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">secondDieValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">numberOfRolls</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="kd">class</span> <span class="nc">DiceRollViewModel</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">_uiState</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="nc">DiceUiState</span><span class="p">())</span>
  <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">DiceUiState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">_uiState</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>

  <span class="c1">// Called from the UI</span>
  <span class="k">fun</span> <span class="nf">rollDice</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">_uiState</span><span class="p">.</span><span class="nf">update</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span>
      <span class="n">currentState</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span>
              <span class="n">firstDieValue</span> <span class="p">=</span> <span class="nc">Random</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">),</span>
              <span class="n">secondDieValue</span> <span class="p">=</span> <span class="nc">Random</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">),</span>
              <span class="n">numberOfRolls</span> <span class="p">=</span> <span class="n">currentState</span><span class="p">.</span><span class="n">numberOfRolls</span> <span class="p">+</span> <span class="mi">1</span><span class="p">,</span>
      <span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//compose</span>
<span class="nd">@Stable</span>
<span class="kd">interface</span> <span class="nc">DiceUiState</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">firstDieValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span>
  <span class="kd">val</span> <span class="py">secondDieValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span>
  <span class="kd">val</span> <span class="py">numberOfRolls</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kd">class</span> <span class="nc">MutableDiceUiState</span><span class="p">:</span> <span class="nc">DiceUiState</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">firstDieValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">secondDieValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">numberOfRolls</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">DiceRollViewModel</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">_uiState</span> <span class="p">=</span> <span class="nc">MutableDiceUiState</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">DiceUiState</span> <span class="p">=</span> <span class="n">_uiState</span>

  <span class="c1">// Called from the UI</span>
  <span class="k">fun</span> <span class="nf">rollDice</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">_uiState</span><span class="p">.</span><span class="n">firstDieValue</span> <span class="p">=</span> <span class="nc">Random</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">_uiState</span><span class="p">.</span><span class="n">secondDieValue</span> <span class="p">=</span> <span class="nc">Random</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">_uiState</span><span class="p">.</span><span class="n">numberOfRolls</span> <span class="p">=</span> <span class="n">_uiState</span><span class="p">.</span><span class="n">numberOfRolls</span> <span class="p">+</span> <span class="mi">1</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="mutating-the-ui-state-from-asynchronous-calls"> <a href="#mutating-the-ui-state-from-asynchronous-calls" class="anchor-heading" aria-labelledby="mutating-the-ui-state-from-asynchronous-calls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mutating the UI state from asynchronous calls </h3> <p>Asenkron bir sonuç gerektiren state değişiklikleri için uygun CoroutineScope’ta bir Coroutine başlatın. Bu, CoroutineScope iptal edildiğinde uygulamanın işi silmesine izin verir. State holder daha sonra suspend method çağrısının sonucunu UI state’ini ortaya çıkarmak için kullanılan gözlemlenebilir API’ye yazar. Örneğin, [Architecture örneği](https://github.com/android/architecture-samplesndeki AddEditTaskViewModel’i göz önünde bulundurun. Askıya alınan(suspend edilen) saveTask() methodu bir taski asenkron olarak kaydettiğinde, MutableStateFlow’daki <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/update.html">update</a> methodu state değişikliğini UI state’ine yayar.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// StateFlow</span>
<span class="kd">data class</span> <span class="nc">AddEditTaskUiState</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="s">""</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="s">""</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">isTaskCompleted</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">isLoading</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">userMessage</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">isTaskSaved</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span>
<span class="p">)</span>

<span class="kd">class</span> <span class="nc">AddEditTaskViewModel</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

   <span class="k">private</span> <span class="kd">val</span> <span class="py">_uiState</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="nc">AddEditTaskUiState</span><span class="p">())</span>
   <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">AddEditTaskUiState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">_uiState</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>

   <span class="k">private</span> <span class="k">fun</span> <span class="nf">createNewTask</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">newTask</span> <span class="p">=</span> <span class="nc">Task</span><span class="p">(</span><span class="n">uiState</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">title</span><span class="p">,</span> <span class="n">uiState</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="n">tasksRepository</span><span class="p">.</span><span class="nf">saveTask</span><span class="p">(</span><span class="n">newTask</span><span class="p">)</span>
                <span class="c1">// Write data into the UI state.</span>
                <span class="n">_uiState</span><span class="p">.</span><span class="nf">update</span> <span class="p">{</span>
                    <span class="n">it</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span><span class="n">isTaskSaved</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="n">cancellationException</span><span class="p">:</span> <span class="nc">CancellationException</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="n">cancellationException</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">_uiState</span><span class="p">.</span><span class="nf">update</span> <span class="p">{</span>
                    <span class="n">it</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span><span class="n">userMessage</span> <span class="p">=</span> <span class="nf">getErrorMessage</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Compose State</span>
<span class="nd">@Stable</span>
<span class="kd">interface</span> <span class="nc">AddEditTaskUiState</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span>
  <span class="kd">val</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span>
  <span class="kd">val</span> <span class="py">isTaskCompleted</span><span class="p">:</span> <span class="nc">Boolean</span>
  <span class="kd">val</span> <span class="py">isLoading</span><span class="p">:</span> <span class="nc">Boolean</span>
  <span class="kd">val</span> <span class="py">userMessage</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span>
  <span class="kd">val</span> <span class="py">isTaskSaved</span><span class="p">:</span> <span class="nc">Boolean</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kd">class</span> <span class="nc">MutableAddEditTaskUiState</span> <span class="p">:</span> <span class="nc">AddEditTaskUiState</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">isTaskCompleted</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">isLoading</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">userMessage</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="k">by</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>
  <span class="k">override</span> <span class="kd">var</span> <span class="py">isTaskSaved</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">AddEditTaskViewModel</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">_uiState</span> <span class="p">=</span> <span class="nc">MutableAddEditTaskUiState</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">AddEditTaskUiState</span> <span class="p">=</span> <span class="n">_uiState</span>

  <span class="k">private</span> <span class="k">fun</span> <span class="nf">createNewTask</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">newTask</span> <span class="p">=</span> <span class="nc">Task</span><span class="p">(</span><span class="n">uiState</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">title</span><span class="p">,</span> <span class="n">uiState</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="n">tasksRepository</span><span class="p">.</span><span class="nf">saveTask</span><span class="p">(</span><span class="n">newTask</span><span class="p">)</span>
        <span class="c1">// Write data into the UI state.</span>
        <span class="n">_uiState</span><span class="p">.</span><span class="n">isTaskSaved</span> <span class="p">=</span> <span class="k">true</span>
      <span class="p">}</span>
      <span class="k">catch</span><span class="p">(</span><span class="n">cancellationException</span><span class="p">:</span> <span class="nc">CancellationException</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">cancellationException</span>
      <span class="p">}</span>
      <span class="k">catch</span><span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_uiState</span><span class="p">.</span><span class="n">userMessage</span> <span class="p">=</span> <span class="nf">getErrorMessage</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><mark style="background-color:lightblue">Not: Bir [AAC ViewModel](/docs/app-architecture/architecture-components/ui-layer-libraries/lifecycle-aware-components/ViewModel/about-viewmodel.md)'in viewModelScope'unda başlatılan coroutineler, istisnai olarak veya başka türlü tamamlanmaya çalışır. Bu, Coroutines açıkça iptal edilmedikçe veya ViewModel temizlenmedikçe, UI görünür olsun ya da olmasın gerçekleşir. Kısa ömürlü olma eğiliminde olduklarından, çoğu istek için bu genellikle uygundur. 5 saniye veya daha uzun süren istekleri çalıştırmak için viewModelScope kullanmamalısınız. Bunun yerine bunları WorkManager ile ertelenmiş veya uzun süreli işler olarak kuyruğa almalısınız.</mark></p> <h3 id="mutating-the-ui-state-from-background-threads"> <a href="#mutating-the-ui-state-from-background-threads" class="anchor-heading" aria-labelledby="mutating-the-ui-state-from-background-threads"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mutating the UI state from background threads </h3> <p>UI state’inin productionu için main dispacther Coroutines’in başlatılması tercih edilir. Yani, aşağıdaki kod parçacıklarındaki withContext bloğunun dışında. Ancak, UI state’ini farklı bir backgroud context’inde güncellemeniz gerekirse, bunu aşağıdaki API’leri kullanarak yapabilirsiniz:</p> <ul> <li>Use the <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/with-context.html">withContext</a> method to run Coroutines in a different concurrent context.</li> <li>When using MutableStateFlow, use the <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/update.html">update</a> method as usual.</li> <li>When using Compose State, use the <a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/snapshots/Snapshot.Companion#withMutableSnapshot(kotlin.Function0)">Snapshot.withMutableSnapshot</a> to guarantee atomic updates to State in the concurrent context.</li> </ul> <p>Örneğin, aşağıdaki DiceRollViewModel parçacığında, SlowRandom.nextInt()’in CPU’ya bağlı bir Coroutine’den çağrılması gereken hesaplama açısından yoğun bir askıya alma işlevi olduğunu varsayalım.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// StateFlow</span>
<span class="kd">class</span> <span class="nc">DiceRollViewModel</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">defaultDispatcher</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Default</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">_uiState</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="nc">DiceUiState</span><span class="p">())</span>
  <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">DiceUiState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">_uiState</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>

  <span class="c1">// Called from the UI</span>
  <span class="k">fun</span> <span class="nf">rollDice</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Other Coroutines that may be called from the current context</span>
      <span class="err">…</span>
      <span class="nf">withContext</span><span class="p">(</span><span class="n">defaultDispatcher</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_uiState</span><span class="p">.</span><span class="nf">update</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span>
          <span class="n">currentState</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span>
                  <span class="n">firstDieValue</span> <span class="p">=</span> <span class="nc">SlowRandom</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">),</span>
                  <span class="n">secondDieValue</span> <span class="p">=</span> <span class="nc">SlowRandom</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">),</span>
                  <span class="n">numberOfRolls</span> <span class="p">=</span> <span class="n">currentState</span><span class="p">.</span><span class="n">numberOfRolls</span> <span class="p">+</span> <span class="mi">1</span><span class="p">,</span>
          <span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Compose State</span>
<span class="kd">class</span> <span class="nc">DiceRollViewModel</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">defaultDispatcher</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Default</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">_uiState</span> <span class="p">=</span> <span class="nc">MutableDiceUiState</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">DiceUiState</span> <span class="p">=</span> <span class="n">_uiState</span>

  <span class="c1">// Called from the UI</span>
  <span class="k">fun</span> <span class="nf">rollDice</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Other Coroutines that may be called from the current context</span>
      <span class="err">…</span>
      <span class="nf">withContext</span><span class="p">(</span><span class="n">defaultDispatcher</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Snapshot</span><span class="p">.</span><span class="nf">withMutableSnapshot</span> <span class="p">{</span>
          <span class="n">_uiState</span><span class="p">.</span><span class="n">firstDieValue</span> <span class="p">=</span> <span class="nc">SlowRandom</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">)</span>
          <span class="n">_uiState</span><span class="p">.</span><span class="n">secondDieValue</span> <span class="p">=</span> <span class="nc">SlowRandom</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="n">from</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">until</span> <span class="p">=</span> <span class="mi">7</span><span class="p">)</span>
          <span class="n">_uiState</span><span class="p">.</span><span class="n">numberOfRolls</span> <span class="p">=</span> <span class="n">_uiState</span><span class="p">.</span><span class="n">numberOfRolls</span> <span class="p">+</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><mark style="background-color:lightblue">Not: Başlatılan tüm coroutinelerin farklı bir contexden çağrılması gerekiyorsa, doğrudan viewModelScope.launch(defaultDispatcher){ } öğesini arayabilirsiniz. </mark></p> <p><mark style="background-color:red">Uyarı: Snapshot.withMutableSnapshot{ } kullanılmadan UI olmayan bir threadden Compose state’inin güncellenmesi, üretilen state’de tutarsızlıklara neden olabilir. </mark></p> <h3 id="stream-apis-as-sources-of-state-change"> <a href="#stream-apis-as-sources-of-state-change" class="anchor-heading" aria-labelledby="stream-apis-as-sources-of-state-change"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stream APIs as sources of state change </h3> <p>Streamlerde zaman içinde birden çok değer üreten state değişikliği kaynakları için, tüm kaynakların outputlarini uyumlu bir bütün halinde birleştirmek, state üretimine(production) doğrudan bir yaklaşımdır.Kotlin Flows kullanırken bunu <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/combine.html">combine</a> fonksiyonu ile başarabilirsiniz. Bunun bir örneği, InterestsViewModel’deki “<a href="https://github.com/android/nowinandroid">Now in Android</a>” örneğinde görülebilir:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InterestsViewModel</span><span class="p">(</span>
    <span class="n">authorsRepository</span><span class="p">:</span> <span class="nc">AuthorsRepository</span><span class="p">,</span>
    <span class="n">topicsRepository</span><span class="p">:</span> <span class="nc">TopicsRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">uiState</span> <span class="p">=</span> <span class="nf">combine</span><span class="p">(</span>
        <span class="n">authorsRepository</span><span class="p">.</span><span class="nf">getAuthorsStream</span><span class="p">(),</span>
        <span class="n">topicsRepository</span><span class="p">.</span><span class="nf">getTopicsStream</span><span class="p">(),</span>
    <span class="p">)</span> <span class="p">{</span> <span class="n">availableAuthors</span><span class="p">,</span> <span class="n">availableTopics</span> <span class="p">-&gt;</span>
        <span class="nc">InterestsUiState</span><span class="p">.</span><span class="nc">Interests</span><span class="p">(</span>
            <span class="n">authors</span> <span class="p">=</span> <span class="n">availableAuthors</span><span class="p">,</span>
            <span class="n">topics</span> <span class="p">=</span> <span class="n">availableTopics</span>
        <span class="p">)</span>
    <span class="p">}</span>
        <span class="p">.</span><span class="nf">stateIn</span><span class="p">(</span>
            <span class="n">scope</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">,</span>
            <span class="n">started</span> <span class="p">=</span> <span class="nc">SharingStarted</span><span class="p">.</span><span class="nc">WhileSubscribed</span><span class="p">(</span><span class="mi">5_000</span><span class="p">),</span>
            <span class="n">initialValue</span> <span class="p">=</span> <span class="nc">InterestsUiState</span><span class="p">.</span><span class="nc">Loading</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p><mark style="background-color:lightblue">Not: Combined Flow’u, UI state için gözlemlenebilir API olarak bir [StateFlow](https://developer.android.com/kotlin/flow/stateflow-and-sharedflow)'a dönüştürmek için [stateIn](https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/state-in.html) operatörünü kullanabilirsiniz. </mark> StateFlows oluşturmak için stateIn operatörünün kullanılması, yalnızca UI görünürken aktif olması gerekebileceğinden, UI’ye state production pipeline’in activitysi üzerinde daha ayrıntılı kontrol sağlar.</p> <ul> <li>Flow’un yaşam döngüsüne duyarlı bir şekilde collect edilmesi sırasında pipeline’in yalnızca UI görünür olduğunda etkin olması gerekiyorsa SharingStarted.WhileSubscription() öğesini kullanın.</li> <li>Kullanıcı UI’e dönebildiği sürece, yani UI backstackde veya ekran dışında başka bir sekmede olduğu sürece pipeline’in aktif olması gerekiyorsa SharingStarted.Lazily kullanın.</li> </ul> <p>Stream tabanlı state kaynaklarının collectinin geçerli olmadığı durumlarda, Kotlin Flows gibi stream API’leri, streamlerin UI state’ine işlenmesine yardımcı olmak için [merging](https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/merge.html?query=fun%20%3CT%3E%20merge(vararg%20flows:%20Flow%3CT%3E), [flattening](https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-latest.html?query=inline%20fun%20%3CT,%20R%3E%20Flow%3CT%3E.flatMapLatest(crossinline%20transform:%20suspend%20(T) vb. gibi zengin bir transformation seti sunar.</p> <p><mark style="background-color: lightblue">Anahtar Nokta: Çoğu durumda combine, stream API'lerinden state productiona yönelik tavsiye edilen bir yaklaşımdır.</mark></p> <h3 id="one-shot-and-stream-apis-as-sources-of-state-change"> <a href="#one-shot-and-stream-apis-as-sources-of-state-change" class="anchor-heading" aria-labelledby="one-shot-and-stream-apis-as-sources-of-state-change"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> One-shot and stream APIs as sources of state change </h3> <p>State production pipeline’in, state değişikliği kaynakları olarak hem tek seferlik(one-shot) çağrılara hem de streamlere bağlı olduğu durumda, tanımlayıcı kısıtlama akışlardır(streams are defining constraint). Bu nedenle, tek seferlik çağrıları stream API’lerine dönüştürün veya outputlarini streamlere aktarın ve yukarıdaki stream bölümünde açıklandığı gibi işlemeye devam edin.</p> <p>Flowlarla, bu genellikle state değişikliklerini yaymak için bir veya daha fazla private backing MutableStateFlow instancei oluşturmak anlamına gelir. Compose state’inden <a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#snapshotFlow(kotlin.Function0)">snapshot flowlari</a> da oluşturabilirsiniz. Aşağıdaki <a href="https://github.com/android/architecture-samples">mimari örnekler</a> repositorysinden TaskDetailViewModel’i göz önünde bulundurun:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//StateFlow</span>
<span class="kd">class</span> <span class="nc">TaskDetailViewModel</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">tasksRepository</span><span class="p">:</span> <span class="nc">TasksRepository</span><span class="p">,</span>
        <span class="n">savedStateHandle</span><span class="p">:</span> <span class="nc">SavedStateHandle</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">_isTaskDeleted</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
  <span class="k">private</span> <span class="kd">val</span> <span class="py">_task</span> <span class="p">=</span> <span class="n">tasksRepository</span><span class="p">.</span><span class="nf">getTaskStream</span><span class="p">(</span><span class="n">taskId</span><span class="p">)</span>

  <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">TaskDetailUiState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">combine</span><span class="p">(</span>
          <span class="n">_isTaskDeleted</span><span class="p">,</span>
          <span class="n">_task</span>
  <span class="p">)</span> <span class="p">{</span> <span class="n">isTaskDeleted</span><span class="p">,</span> <span class="n">task</span> <span class="p">-&gt;</span>
    <span class="nc">TaskDetailUiState</span><span class="p">(</span>
            <span class="n">task</span> <span class="p">=</span> <span class="n">taskAsync</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">isTaskDeleted</span> <span class="p">=</span> <span class="n">isTaskDeleted</span>
    <span class="p">)</span>
  <span class="p">}</span>
          <span class="c1">// Convert the result to the appropriate observable API for the UI</span>
          <span class="p">.</span><span class="nf">stateIn</span><span class="p">(</span>
                  <span class="n">scope</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">,</span>
                  <span class="n">started</span> <span class="p">=</span> <span class="nc">SharingStarted</span><span class="p">.</span><span class="nc">WhileSubscribed</span><span class="p">(</span><span class="mi">5_000</span><span class="p">),</span>
                  <span class="n">initialValue</span> <span class="p">=</span> <span class="nc">TaskDetailUiState</span><span class="p">()</span>
          <span class="p">)</span>

  <span class="k">fun</span> <span class="nf">deleteTask</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
    <span class="n">tasksRepository</span><span class="p">.</span><span class="nf">deleteTask</span><span class="p">(</span><span class="n">taskId</span><span class="p">)</span>
    <span class="n">_isTaskDeleted</span><span class="p">.</span><span class="nf">update</span> <span class="p">{</span> <span class="k">true</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Compose State</span>
<span class="kd">class</span> <span class="nc">TaskDetailViewModel</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">tasksRepository</span><span class="p">:</span> <span class="nc">TasksRepository</span><span class="p">,</span>
        <span class="n">savedStateHandle</span><span class="p">:</span> <span class="nc">SavedStateHandle</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">var</span> <span class="py">_isTaskDeleted</span> <span class="k">by</span> <span class="nf">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
  <span class="k">private</span> <span class="kd">val</span> <span class="py">_task</span> <span class="p">=</span> <span class="n">tasksRepository</span><span class="p">.</span><span class="nf">getTaskStream</span><span class="p">(</span><span class="n">taskId</span><span class="p">)</span>

  <span class="kd">val</span> <span class="py">uiState</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">TaskDetailUiState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">combine</span><span class="p">(</span>
          <span class="nf">snapshotFlow</span> <span class="p">{</span> <span class="n">_isTaskDeleted</span> <span class="p">},</span>
          <span class="n">_task</span>
  <span class="p">)</span> <span class="p">{</span> <span class="n">isTaskDeleted</span><span class="p">,</span> <span class="n">task</span> <span class="p">-&gt;</span>
    <span class="nc">TaskDetailUiState</span><span class="p">(</span>
            <span class="n">task</span> <span class="p">=</span> <span class="n">taskAsync</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">isTaskDeleted</span> <span class="p">=</span> <span class="n">isTaskDeleted</span>
    <span class="p">)</span>
  <span class="p">}</span>
          <span class="c1">// Convert the result to the appropriate observable API for the UI</span>
          <span class="p">.</span><span class="nf">stateIn</span><span class="p">(</span>
                  <span class="n">scope</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">,</span>
                  <span class="n">started</span> <span class="p">=</span> <span class="nc">SharingStarted</span><span class="p">.</span><span class="nc">WhileSubscribed</span><span class="p">(</span><span class="mi">5_000</span><span class="p">),</span>
                  <span class="n">initialValue</span> <span class="p">=</span> <span class="nc">TaskDetailUiState</span><span class="p">()</span>
          <span class="p">)</span>

  <span class="k">fun</span> <span class="nf">deleteTask</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
    <span class="n">tasksRepository</span><span class="p">.</span><span class="nf">deleteTask</span><span class="p">(</span><span class="n">taskId</span><span class="p">)</span>
    <span class="n">_isTaskDeleted</span> <span class="p">=</span> <span class="k">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><mark style="background-color: lightblue">Not: Compose State, [snapshotFlow { }](https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#snapshotFlow(kotlin.Function0)) API kullanılarak bir flowa dönüştürülür. Başka bir örnek için "Now In Android" örneğindeki [ForYouViewModel](https://github.com/android/nowinandroid/blob/main/feature-foryou/src/main/java/com/google/samples/apps/nowinandroid/feature/foryou/ForYouViewModel.kt)'e bakın.</mark></p> <p>Output types in state production pipelines</p> <p>UI State için output API’sinin seçimi ve sunumunun doğası, büyük ölçüde uygulamanızın UI’ini oluşturmak için kullandığı API’ye bağlıdır. Android uygulamalarında Views veya Jetpack Compose kullanmayı seçebilirsiniz. Buradaki hususlar şunları içerir:</p> <ul> <li> <p>State’i <a href="https://medium.com/androiddevelopers/consuming-flows-safely-in-jetpack-compose-cde014d0d5a3">yaşam döngüsüne duyarlı</a> bir şekilde okuma.</p> </li> <li> <p>State’in, state holderinden <a href="about-the-ui-layer.md#additional-considerations">bir veya daha fazla field’inden gösterilmesi</a> gerekip gerekmediği.</p> </li> </ul> <p>Aşağıdaki tablo, herhangi bir input ve consumer için state production pipeline için hangi API’lerin kullanılacağını özetlemektedir:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Input</th> <th>Consumer</th> <th>Output</th> </tr> </thead> <tbody> <tr> <td>One-shot APIs</td> <td>Views</td> <td>StateFlow or LiveData</td> </tr> <tr> <td>One-shot APIs</td> <td>Compose</td> <td>StateFlow or Compose State</td> </tr> <tr> <td>Stream APIs</td> <td>Views</td> <td>StateFlow or LiveData</td> </tr> <tr> <td>Stream APIs</td> <td>Compose</td> <td>StateFlow</td> </tr> <tr> <td>One-shot and stream APIs</td> <td>Views</td> <td>StateFlow or LiveData</td> </tr> <tr> <td>One-shot and stream APIs</td> <td>Compose</td> <td>StateFlow</td> </tr> </tbody> </table></div> <h3 id="state-production-pipeline-initialization"> <a href="#state-production-pipeline-initialization" class="anchor-heading" aria-labelledby="state-production-pipeline-initialization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State production pipeline initialization </h3> <p>State production pipeline’larının başlatılması, pipeline’ın çalışması için ilk koşulların ayarlanmasını içerir. Bu, örneğin bir haber makalesinin detail view’i için bir ID gibi pipeline’ın başlatılması için kritik olan ilk girdi değerlerinin sağlanmasını veya asenkron bir yüklemenin başlatılmasını içerebilir.</p> <p>Sistem kaynaklarını korumak için state production pipeline’ı mümkün olduğunca lazily başlatmalısınız. Pratikte bu genellikle çıktının bir tüketicisi olana kadar beklemek anlamına gelir. Flow API’leri, <a href="https://developer.android.com/topic/architecture/ui-layer/17">stateIn</a> metodundaki <a href="https://developer.android.com/topic/architecture/ui-layer/31">started</a> argümanı ile buna izin verir. Bunun uygulanamaz olduğu durumlarda, aşağıdaki kod parçasında gösterildiği gibi state production pipeline’ı explicit olarak başlatmak için <a href="https://en.wikipedia.org/wiki/Idempotence">idempotent</a> bir initialize() fonksiyonu tanımlayın:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyViewModel</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">initializeCalled</span> <span class="p">=</span> <span class="k">false</span>

    <span class="c1">// This function is idempotent provided it is only called from the UI thread.</span>
    <span class="nd">@MainThread</span>
    <span class="k">fun</span> <span class="nf">initialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">initializeCalled</span><span class="p">)</span> <span class="k">return</span>
        <span class="n">initializeCalled</span> <span class="p">=</span> <span class="k">true</span>

        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="c1">// seed the state production pipeline</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><mark style="background-color:red">Uyarı: Bir ViewModel'in init bloğunda veya constructor'ında asenkron işlemler başlatmaktan kaçının. Asenkron işlemler bir nesne oluşturmanın yan etkisi olmamalıdır çünkü asenkron kod, nesne tam olarak başlatılmadan önce nesneden okuyabilir veya nesneye yazabilir. Bu aynı zamanda leaking the object (nesnenin sızdırılması) olarak da adlandırılır ve ince ve teşhis edilmesi zor hatalara yol açabilir. Bu özellikle Compose State ile çalışırken önemlidir. ViewModel Compose State fieldlarini tuttuğunda, ViewModel'in init bloğunda Compose State fieldlarını güncelleyen bir Coroutine başlatmayın, aksi takdirde bir IllegalStateException oluşabilir. </mark></p> <h3 id="samples"> <a href="#samples" class="anchor-heading" aria-labelledby="samples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://developer.android.com/topic/architecture/ui-layer/state-production#samples">Samples</a> </h3> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
