<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>About the data layer | Türkçe Android Dokümantasyonu</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="About the data layer" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Android Dokümantasyonu Türkçe Çeviri Projesi" /> <meta property="og:description" content="Android Dokümantasyonu Türkçe Çeviri Projesi" /> <link rel="canonical" href="http://localhost:4000/docs/app-architecture/guide-to-app-architecture/data-layer/about-the-data-layer.html" /> <meta property="og:url" content="http://localhost:4000/docs/app-architecture/guide-to-app-architecture/data-layer/about-the-data-layer.html" /> <meta property="og:site_name" content="Türkçe Android Dokümantasyonu" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="About the data layer" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Android Dokümantasyonu Türkçe Çeviri Projesi","headline":"About the data layer","url":"http://localhost:4000/docs/app-architecture/guide-to-app-architecture/data-layer/about-the-data-layer.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Türkçe Android Dokümantasyonu </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Ana Sayfa</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in App basics category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-basics" class="nav-list-link">App basics</a><ul class="nav-list"><li class="nav-list-item "><a href="/docs/app-basics/build-your-first-app.html" class="nav-list-link">Build Your First App</a></li><li class="nav-list-item "><a href="/docs/app-basics/app-fundamentals.html" class="nav-list-link">App fundamentals</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App resources category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-basics/app-resources/app-resources.html" class="nav-list-link">App resources</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/about-app-resources.html" class="nav-list-link">About app resources</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/handle-configuration-changes.html" class="nav-list-link">Handle configuration changes</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/localization/localization.html" class="nav-list-link">Localization</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/complex-xml-resources.html" class="nav-list-link">Complex XML resources</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-resources/resource-types/resource-types.html" class="nav-list-link">Resource types</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App manifest file category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-basics/app-manifest-file/app-manifest-file.html" class="nav-list-link">App manifest file</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/about-app-manifests.html" class="nav-list-link">About app manifests</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/action.html" class="nav-list-link">action</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/activity.html" class="nav-list-link">activity</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/activity-alias.html" class="nav-list-link">action</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/application.html" class="nav-list-link">application</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/category.html" class="nav-list-link">category</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/compatible-screens.html" class="nav-list-link">action</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/data.html" class="nav-list-link">data</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/grant-uri-permission.html" class="nav-list-link">grant-uri-permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/instrumentation.html" class="nav-list-link">instrumentation</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/intent-filter.html" class="nav-list-link">intent-filter</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/layout.html" class="nav-list-link">layout</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/manifest.html" class="nav-list-link">manifest</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/meta-data.html" class="nav-list-link">meta-data</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/path-permission.html" class="nav-list-link">path-permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/permission.html" class="nav-list-link">permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/permission-group.html" class="nav-list-link">permission-group</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/permission-tree.html" class="nav-list-link">permission tree</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/property.html" class="nav-list-link">property</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/receiver.html" class="nav-list-link">receiver</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/service.html" class="nav-list-link">service</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/supports-gl-texture.html" class="nav-list-link">supports-gl-texture</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/supports-screens.html" class="nav-list-link">supports-screens</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-configuration.html" class="nav-list-link">uses-configuration</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-feature.html" class="nav-list-link">manifest</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-library.html" class="nav-list-link">uses-library</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-native-library.html" class="nav-list-link">uses-native-library</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-permission.html" class="nav-list-link">uses-permission</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-permission-sdk-23.html" class="nav-list-link">uses-permission-sdk-23</a> </li><li class="nav-list-item "> <a href="/docs/app-basics/app-manifest-file/uses-sdk.html" class="nav-list-link">uses-sdk</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in App architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture" class="nav-list-link">App architecture</a><ul class="nav-list"><li class="nav-list-item "><a href="/docs/app-architecture/introduction.html" class="nav-list-link">Introduction</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Guide to app architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/guide-to-app-architecture/guide-to-app-architecture.html" class="nav-list-link">Guide to app architecture</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/about-app-architecture.html" class="nav-list-link">About app architecture</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/ui-layer/ui-layer.html" class="nav-list-link">Ui layer</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/domain-layer.html" class="nav-list-link">Domain layer</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/data-layer/data-layer.html" class="nav-list-link">Data layer</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/architecture-recommendatios.html" class="nav-list-link">Architecture recommendations</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/guide-to-app-architecture/learning-pathway.html" class="nav-list-link">Learning pathway</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Modularization category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/modularization/modularization.html" class="nav-list-link">Modularization</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/modularization/about-modularization.html" class="nav-list-link">About modularization</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/modularization/common-patterns.html" class="nav-list-link">Common patterns</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/modularization/recipes.html" class="nav-list-link">Recipes</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Architecture components category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/architecture-components/architecture-components.html" class="nav-list-link">Architecture components</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/architecture-components/ui-layer-libraries/ui-layer-libraries.html" class="nav-list-link">UI layer libraries</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/architecture-components/data-layer-libraries/data-layer-libraries.html" class="nav-list-link">Data layer libraries</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App entry points category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/app-entry-points/app-entry-points.html" class="nav-list-link">App entry points</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/app-entry-points/activities/activities.html" class="nav-list-link">Activities</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-entry-points/app-shortcuts/app-shortcuts.html" class="nav-list-link">App shortcuts</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in App navigation category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/app-navigation/app-navigation.html" class="nav-list-link">App navigation</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/principles-of-navigation.html" class="nav-list-link">Principles of navigation</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/design-for-different-form-factors.html" class="nav-list-link">Design for different form factors</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/handle-configuration-changes.html" class="nav-list-link">Handle configuration changes</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/navigation-component/navigation-component.html" class="nav-list-link">Navigation component</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/fragments/fragments.html" class="nav-list-link">Fragments</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/app-links/app-links.html" class="nav-list-link">App links</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/create-swipe-views-with-tabs-using-viewpager.html" class="nav-list-link">Create swipe views with tabs using ViewPager</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/create-swipe-views-with-tabs-using-viewpager2.html" class="nav-list-link">Create swipe views with tabs using ViewPager2</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/app-navigation/add-support-for-back-navigation/add-support-for-back-navigation.html" class="nav-list-link">Add support for back navigation</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Dependency Injection category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/app-architecture/dependency-injection/dependency-injection.html" class="nav-list-link">Dependency Injection</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/about-dependency-injection.html" class="nav-list-link">About dependency injection</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/manual-dependency-injection.html" class="nav-list-link">Manual dependency injection</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/dependency-injetion-with-hilt.html" class="nav-list-link">Dependency injection with Hilt</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/hilt-in-multi-module-apps.html" class="nav-list-link">Hilt in multi-module apps</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/use-hilt-with-other-jetpack-libraries.html" class="nav-list-link">Use Hilt with other Jetpack libraries</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/hilt-testing-guide.html" class="nav-list-link">Hilt testing guide</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/hilt-and-dagger-annotations-cheat-sheet.html" class="nav-list-link">Hilt and Dagger annotations cheat sheet</a> </li><li class="nav-list-item "> <a href="/docs/app-architecture/dependency-injection/dagger/dagger.html" class="nav-list-link">Dagger</a> </li></ul></li><li class="nav-list-item "><a href="/docs/app-architecture/app-startup.html" class="nav-list-link">App startup</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Core topics category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/core-topics" class="nav-list-link">Core topics</a><ul class="nav-list"></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Best practices category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docs/best-practices" class="nav-list-link">Best practices</a><ul class="nav-list"></ul></li></ul> </nav> <footer class="site-footer"> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Ara" aria-label="Ara" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Guide to app architecture</a></li> <li class="breadcrumb-nav-list-item"><a href="">Data layer</a></li> <li class="breadcrumb-nav-list-item"><span>About the data layer</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="data-layer"> <a href="#data-layer" class="anchor-heading" aria-labelledby="data-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Layer </h1> <h2 id="about-the-data-layer"> <a href="#about-the-data-layer" class="anchor-heading" aria-labelledby="about-the-data-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> About the data layer </h2> <p>UI katmanı UI ile ilgili state ve UI logic’i içerirken, data katmanı uygulama verilerini ve business logic’i içerir. Business logic (iş mantığı) uygulamanıza değer katan şeydir; uygulama verilerinin nasıl oluşturulması, saklanması ve değiştirilmesi gerektiğini belirleyen gerçek dünya iş kurallarından oluşur.</p> <p>Separation of concerns ilkesinin bu sekilde olması, veri katmanının birden fazla ekranda kullanılmasına, uygulamanın farklı bölümleri arasında bilgi paylaşılmasına ve birim testi için iş mantığının kullanıcı arayüzünün dışında yeniden üretilmesine olanak tanır. Data katmanının faydaları hakkında daha fazla bilgi için <a href="/docs/app-architecture/guide-to-app-architecture/guide-to-app-architecture">Architecture Overview</a> sayfasına göz atın.</p> <p><mark style="background-color:lightblue">ot: Bu sayfada yer alan öneriler ve best practiceler, ölçeklenmelerini sağlamak, kaliteyi ve sağlamlığı artırmak ve test edilmelerini kolaylaştırmak için geniş bir uygulama yelpazesine uygulanabilir. Ancak, bunları kılavuz olarak ele almalı ve gerektiğinde gereksinimlerinize göre uyarlamalısınız.</mark></p> <p><a href="https://youtu.be/r5AseKQh2ZE">Architecture: The data layer - MAD Skills</a></p> <h3 id="data-layer-architecture"> <a href="#data-layer-architecture" class="anchor-heading" aria-labelledby="data-layer-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data layer architecture </h3> <p>Data katmanı, her biri sıfır ila çok sayıda veri kaynağı içerebilen repository’lerden oluşur. Uygulamanızda işlediğiniz her farklı veri türü için bir repository sınıfı oluşturmalısınız. Örneğin, filmlerle ilgili veriler için bir MoviesRepository sınıfı veya ödemelerle ilgili veriler için bir PaymentsRepository sınıfı oluşturabilirsiniz. <img src="/assets/images/data-layer.png" alt="Data layer architecture" /></p> <p>Repository sınıfları aşağıdaki görevlerden sorumludur:</p> <ul> <li>Verilerin uygulamanın geri kalanına sunulması.</li> <li>Verilerdeki değişiklikleri merkezileştirme.</li> <li>Birden fazla veri kaynağı arasındaki çakışmaları çözme.</li> <li>Uygulamanın geri kalanından veri kaynaklarını soyutlama.</li> <li>Business logic’i içermek.</li> </ul> <p>Her veri kaynağı sınıfı(data source class) , bir dosya, bir network kaynağı veya local veritabanı olabilen sadece tek bir veri kaynağı ile çalışma sorumluluğuna sahip olmalıdır. Veri kaynağı sınıfları, veri işlemleri için uygulama ile sistem arasındaki köprüdür.</p> <p>Hiyerarşideki diğer katmanlar veri kaynaklarına asla doğrudan erişmemelidir; data katmanına entry pointler her zaman repository sınıflarıdır. State holder sınıfları (<a href="/docs/app-architecture/guide-to-app-architecture/ui-layer/about-the-ui-layer">UI katmanı</a> kılavuzuna bakın) veya use case sınıfları (<a href="/docs/app-architecture/guide-to-app-architecture/domain-layer.md">domain katmanı</a> kılavuzuna bakın) hiçbir zaman doğrudan bir bağımlılık olarak bir veri kaynağına sahip olmamalıdır. Repository sınıflarının entry point olarak kullanılması, mimarinin farklı katmanlarının bağımsız olarak ölçeklenebilmesini sağlar. Bu katman tarafından açığa çıkarılan veriler immutable olmalıdır, böylece diğer sınıflar tarafından kurcalanamaz, bu da değerlerini tutarsız bir duruma sokma riski taşır. Immutable veriler birden fazla thread tarafından da güvenli bir şekilde işlenebilir. Daha fazla ayrıntı için thread bölümüne bakın.</p> <p><a href="/docs/app-architecture/dependency-injection/about-dependency-injection">Dependency injection best practices</a>‘i takiben, repository veri kaynaklarını constructor’ında dependency olarak alır:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ExampleRepository</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">exampleRemoteDataSource</span><span class="p">:</span> <span class="nc">ExampleRemoteDataSource</span><span class="p">,</span> <span class="c1">// network</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">exampleLocalDataSource</span><span class="p">:</span> <span class="nc">ExampleLocalDataSource</span> <span class="c1">// database</span>
<span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</code></pre></div></div> <p><mark style="background-color: lightblue">Not: Genellikle, bir repository yalnızca tek bir veri kaynağı içerdiğinde ve diğer repository'lere bağlı olmadığında, geliştiriciler repository'lerin ve veri kaynaklarının sorumluluklarını repository sınıfında birleştirir. Bunu yaparsanız, uygulamanızın sonraki bir sürümünde repository'nin başka bir kaynaktan gelen verileri işlemesi gerekiyorsa fonksiyonları bölmeyi unutmayın.</mark></p> <h3 id="expose-apis"> <a href="#expose-apis" class="anchor-heading" aria-labelledby="expose-apis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expose APIs </h3> <p>Data katmanındaki sınıflar genellikle tek seferlik Create, Read, Update ve Delete (CRUD) çağrıları gerçekleştirmek veya zaman içindeki veri değişikliklerinden haberdar olmak için fonksiyonları kullanıma sunar. Data katmanı bu durumların her biri için aşağıdakileri sağlamalıdır:</p> <ul> <li>Tek seferlik işlemler: Data katmanı Kotlin’de suspend fonksiyonlarını kullanıma sunmalıdır; ve Java programlama dili için, data katmanı işlemin sonucunu bildirmek için bir callback sağlayan fonksiyonları veya RxJava Single, Maybe veya Completable tiplerini kullanıma sunmalıdır.</li> <li>Zaman içindeki veri değişikliklerinden haberdar olmak için: Data katmanı Kotlin’de <a href="https://developer.android.com/kotlin/flow">flow</a>‘ları kullanıma sunmalıdır; ve Java programlama dili için data katmanı yeni veriyi veya RxJava Observable veya Flowable türünü yayınlayan bir callback’i kullanıma sunmalıdır.</li> </ul> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ExampleRepository</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">exampleRemoteDataSource</span><span class="p">:</span> <span class="nc">ExampleRemoteDataSource</span><span class="p">,</span> <span class="c1">// network</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">exampleLocalDataSource</span><span class="p">:</span> <span class="nc">ExampleLocalDataSource</span> <span class="c1">// database</span>
<span class="p">)</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">data</span><span class="p">:</span> <span class="nc">Flow</span><span class="p">&lt;</span><span class="nc">Example</span><span class="p">&gt;</span> <span class="p">=</span> <span class="o">..</span><span class="p">.</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">modifyData</span><span class="p">(</span><span class="n">example</span><span class="p">:</span> <span class="nc">Example</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">..</span><span class="p">.</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="naming-conventions-in-this-guide"> <a href="#naming-conventions-in-this-guide" class="anchor-heading" aria-labelledby="naming-conventions-in-this-guide"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Naming conventions in this guide </h3> <p>Bu kılavuzda, repository sınıfları sorumlu oldukları verilere göre adlandırılmıştır. Kurallar aşağıdaki gibidir:</p> <p>veri türü + Repository.</p> <p>Örneğin: NewsRepository, MoviesRepository veya PaymentsRepository.</p> <p>Veri kaynağı sınıfları, sorumlu oldukları verilerden ve kullandıkları kaynaktan sonra adlandırılır. Kurallar aşağıdaki gibidir:</p> <p>veri türü + kaynak türü + DataSource.</p> <p>Veri türü için, uygulamalar değişebileceğinden daha genel olması için Remote veya Local kullanın. Örneğin: NewsRemoteDataSource veya NewsLocalDataSource. Kaynağın önemli olması durumunda daha spesifik olmak için kaynağın türünü kullanın. Örneğin: NewsNetworkDataSource veya NewsDiskDataSource.</p> <p>Veri kaynağını bir uygulama detayına göre adlandırmayın (örneğin UserSharedPreferencesDataSource) çünkü bu veri kaynağını kullanan repository’ler verilerin nasıl kaydedildiğini bilmemelidir. Bu kurala uyarsanız, veri kaynağının uygulamasını, bu kaynağı çağıran katmanı etkilemeden değiştirebilirsiniz ( örneğin, <a href="https://developer.android.com/training/data-storage/shared-preferences">SharedPreferences</a>’ tan <a href="https://developer.android.com/topic/libraries/architecture/datastore">DataStore</a>‘a geçiş).</p> <p><mark style="background-color:lightblue">Not: Bir veri kaynağının yeni bir implementasyonuna geçerken, veri kaynağı için bir interface oluşturabilir ve veri kaynağının iki implementasyonuna sahip olabilirsiniz: biri eski backing teknolojisi için, diğeri de yenisi için. Bu durumda, veri kaynağı sınıf adları için teknolojinin adını kullanmanızda bir sakınca yoktur (bu bir uygulama ayrıntısı olsa bile) çünkü repository veri kaynağı sınıflarının kendisini değil yalnızca interface'i görür. Taşıma işlemini tamamladığınızda, yeni sınıfı, adında uygulama ayrıntısı içermeyecek şekilde yeniden adlandırabilirsiniz.</mark></p> <h3 id="multiple-levels-of-repositories"> <a href="#multiple-levels-of-repositories" class="anchor-heading" aria-labelledby="multiple-levels-of-repositories"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multiple levels of repositories </h3> <p>Daha karmaşık iş gereksinimlerini içeren bazı durumlarda, bir repository’nin diğer repository’lere bağımlı olması gerekebilir. Bunun nedeni, ilgili verilerin birden fazla veri kaynağından toplanması veya sorumluluğun başka bir repository sınıfında encapsulated edilmesi gerekliligi olabilir. Örneğin, kullanıcı kimlik doğrulama verilerini işleyen bir repository, UserRepository, gereksinimlerini yerine getirmek için LoginRepository ve RegistrationRepository gibi diğer repository’lere bağımlı olabilir.</p> <p><img src="/assets/images/data-layer-img1.png" alt="Dependency graph of a repository that depends on other repositories." /></p> <p><mark style="background-color: lightblue">Not: Geleneksel olarak, bazı geliştiriciler diğer repository sınıflarına bağlı olan repository sınıflarını manager olarak adlandırırlar; örneğin UserRepository yerine UserManager. İsterseniz bu adlandırma kuralını kullanabilirsiniz.</mark></p> <h3 id="source-of-truth"> <a href="#source-of-truth" class="anchor-heading" aria-labelledby="source-of-truth"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Source of truth </h3> <p>Her repository’nin tek bir doğruluk kaynağı(single source of truth) tanımlaması önemlidir. Doğruluk kaynağı her zaman tutarlı, doğru ve güncel veriler içerir. Aslında, repository’den açığa çıkan veriler her zaman doğrudan doğruluk kaynağından gelen veriler olmalıdır.</p> <p>Doğruluk kaynağı bir veri kaynağı (örneğin veri tabanı) ya da repository’nin içerebileceği bir in-memory cache olabilir. Repository’ler farklı veri kaynaklarını birleştirir ve veri kaynakları arasındaki olası çakışmaları çözerek tek doğruluk kaynağını düzenli olarak veya bir user input event nedeniyle günceller.</p> <p>Uygulamanızdaki farklı veri repositoryleri farklı doğruluk kaynaklarına sahip olabilir. Örneğin, LoginRepository sınıfı doğruluk kaynağı olarak cache’ini kullanabilir ve PaymentsRepository sınıfı network veri kaynağını kullanabilir.</p> <p>Offline-first desteği sağlamak için, veritabanı gibi local bir veri kaynağı önerilen doğruluk kaynağıdır.</p> <h3 id="threading"> <a href="#threading" class="anchor-heading" aria-labelledby="threading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Threading </h3> <p>Veri kaynaklarını ve repository’leri çağırmak, main thread’den çağırmak için main-safe/güvenli olmalıdır. Bu sınıflar, uzun süreli bloklama operasyonları gerçekleştirirken logiclerinin yürütülmesini uygun thread’e taşımaktan sorumludur. Örneğin, bir veri kaynağının bir dosyadan okuma yapması ya da bir veri repository’sinin büyük bir liste üzerinde yüklü filtreleme yapması main-safe olmalıdır.</p> <p>Çoğu veri kaynağının Room, Retrofit veya Ktor tarafından sağlanan suspend metot çağrıları gibi main-safe API’leri zaten sağladığını unutmayın. Repositoryniz, kullanılabilir olduklarında bu API’lerden yararlanabilir.</p> <p>Threading hakkında daha fazla bilgi edinmek için background processing kılavuzuna bakın. Kotlin kullanıcıları için coroutine’ler önerilen seçenektir. Java programlama dili için önerilen seçenekler için Android task’larını background thread’lerde çalıştırma bölümüne bakın.</p> <h3 id="lifecycle"> <a href="#lifecycle" class="anchor-heading" aria-labelledby="lifecycle"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lifecycle </h3> <p>Data katmanındaki sınıfların instance’ları, bir garbage collection root’undan (genellikle uygulamanızdaki diğer nesnelerden referans alınarak) erişilebilir oldukları sürece bellekte kalırlar.</p> <p>Bir sınıf in-memory veriler içeriyorsa (örneğin bir cache), bu sınıfın aynı instance’ını belirli bir süre için yeniden kullanmak isteyebilirsiniz. Bu, sınıf instance’ının yaşam döngüsü olarak da adlandırılır.</p> <p>Sınıfın sorumluluğu tüm uygulama için çok önemliyse, bu sınıfın bir instance’ını Application sınıfına scope edebilirsiniz. Bu, instance’ın uygulamanın yaşam döngüsünü takip etmesini sağlar. Alternatif olarak, aynı instance’ı yalnızca uygulamanızdaki belirli bir akışta (örneğin, kayıt veya oturum açma akışı) yeniden kullanmanız gerekiyorsa, instance’ı bu akışın yaşam döngüsüne sahip olan sınıfa scope etmelisiniz. Örneğin, in-memory veriler içeren bir RegistrationRepository’yi RegistrationActivity’ye veya kayıt akışının navigation graph’ine scope edebilirsiniz.</p> <p>Her bir instance’ın yaşam döngüsü, uygulamanızda bağımlılıkları nasıl sağlayacağınıza karar vermede kritik bir faktördür. Bağımlılıkların yönetildiği ve bağımlılık contaitnerlarina scop edilebildiği dependency injection best practicelerini takip etmeniz önerilir. Android’de scoping hakkında daha fazla bilgi edinmek için Android’de Scoping ve Hilt blog gönderisine bakın.</p> <h3 id="represent-business-models"> <a href="#represent-business-models" class="anchor-heading" aria-labelledby="represent-business-models"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Represent business models </h3> <p>Data katmanından göstermek istediğiniz veri modelleri, farklı veri kaynaklarından aldığınız bilgilerin bir alt kümesi olabilir. İdeal olarak, farklı veri kaynakları (hem network hem de local) yalnızca uygulamanızın ihtiyaç duyduğu bilgileri döndürmelidir; ancak durum genellikle böyle değildir.</p> <p>Örneğin, yalnızca makale bilgilerini değil, aynı zamanda düzenleme geçmişini, kullanıcı yorumlarını ve bazı meta verileri de döndüren bir News API sunucusu düşünün:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">ArticleApiModel</span><span class="p">(</span>
        <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">content</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">publicationDate</span><span class="p">:</span> <span class="nc">Date</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">modifications</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">ArticleApiModel</span><span class="p">&gt;,</span>
        <span class="kd">val</span> <span class="py">comments</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">CommentApiModel</span><span class="p">&gt;,</span>
        <span class="kd">val</span> <span class="py">lastModificationDate</span><span class="p">:</span> <span class="nc">Date</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">authorId</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">authorName</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">authorDateOfBirth</span><span class="p">:</span> <span class="nc">Date</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">readTimeMin</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span>
</code></pre></div></div> <p>Uygulama, makale hakkında çok fazla bilgiye ihtiyaç duymaz çünkü ekranda yalnızca makalenin içeriğini ve yazarıyla ilgili temel bilgileri görüntüler. Model sınıflarını ayırmak ve repository’lerinizin yalnızca hiyerarşinin diğer katmanlarının ihtiyaç duyduğu verileri göstermesini sağlamak iyi bir pratiktir. Örneğin, bir Article model sınıfını domain ve UI katmanlarına göstermek için ArticleApiModel’i ağdan şu şekilde kırpabilirsiniz:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">Article</span><span class="p">(</span>
        <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">content</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">publicationDate</span><span class="p">:</span> <span class="nc">Date</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">authorName</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">readTimeMin</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span>
</code></pre></div></div> <p>Model sınıflarını ayırmak aşağıdaki şekillerde faydalıdır:</p> <ul> <li> <p>Verileri yalnızca ihtiyaç duyulana indirgeyerek uygulama belleğinden tasarruf sağlar.</p> </li> <li> <p>Harici veri türlerini uygulamanız tarafından kullanılan veri türlerine uyarlar - örneğin, uygulamanız tarihleri temsil etmek için farklı bir veri türü kullanabilir.</p> </li> <li> <p>Separation of concers ilkesini daha iyi sağlar; örneğin, model sınıfı önceden tanımlanırsa büyük bir ekibin üyeleri bir feature’in network ve UI katmanları üzerinde ayrı ayrı çalışabilir.</p> </li> </ul> <p>Bu pratiği genişletebilir ve uygulama mimarinizin diğer bölümlerinde de ayrı model sınıfları tanımlayabilirsiniz; örneğin veri kaynağı sınıflarında ve ViewModel’lerde. Ancak bu, düzgün bir şekilde belgelemeniz ve test etmeniz gereken ekstra sınıflar ve logic tanımlamanızı gerektirir. En azından, bir veri kaynağının uygulamanızın geri kalanının beklediği verilerle eşleşmeyen veriler aldığı her durumda yeni modeller oluşturmanız önerilir.</p> <h3 id="types-of-daya-operations"> <a href="#types-of-daya-operations" class="anchor-heading" aria-labelledby="types-of-daya-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Types of daya operations </h3> <p>Data katmanı, ne kadar kritik olduklarına bağlı olarak değişen işlem türleriyle çalışabilir:UI-oriented, app-oriented, and business-oriented operations.</p> <h3 id="ui-oriented-operations"> <a href="#ui-oriented-operations" class="anchor-heading" aria-labelledby="ui-oriented-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> UI-oriented operations </h3> <p>UI odaklı işlemler yalnızca kullanıcı belirli bir ekrandayken geçerlidir ve kullanıcı o ekrandan ayrıldığında iptal edilirler. Veritabanından elde edilen bazı verilerin görüntülenmesi buna bir örnektir.</p> <p>UI odaklı işlemler genellikle UI katmanı tarafından tetiklenir ve çağıranın yaşam döngüsünü (örneğin ViewModel’in yaşam döngüsü) takip eder. UI odaklı bir işlem örneği için <a href="#make-a-network-request">Network isteği yapma</a> bölümüne bakın.</p> <h3 id="app-oriented-operations"> <a href="#app-oriented-operations" class="anchor-heading" aria-labelledby="app-oriented-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> App-oriented operations </h3> <p>Uygulama odaklı işlemler, uygulama açık olduğu sürece geçerlidir. Uygulama kapatılırsa veya işlem öldürülürse, bu işlemler iptal edilir. Bir network isteğinin sonucunun, gerektiğinde daha sonra kullanılabilmesi için önbelleğe alınması buna bir örnektir. Daha fazla bilgi için <a href="#caches">in-memory data caching</a> bölümüne bakın.</p> <p>Bu işlemler genellikle Application sınıfının veya data katmanının yaşam döngüsünü takip eder. Bir örnek için, <a href="#make-an-operation-live-longer-than-the-screen">Bir işlemi ekrandan daha uzun süre yaşatın</a> bölümüne bakın.</p> <h3 id="business-oriented-operations"> <a href="#business-oriented-operations" class="anchor-heading" aria-labelledby="business-oriented-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Business-oriented operations </h3> <p>İş odaklı işlemler iptal edilemez. İşlem ölümünden sağ çıkmalıdırlar. Kullanıcının profiline göndermek istediği bir fotoğrafın yüklemesini bitirmek buna bir örnektir.</p> <p>İş odaklı işlemler için öneri WorkManager kullanmaktır. Daha fazla bilgi edinmek için <a href="#schedule-tasks-using-workmanager">WorkManager kullanarak görevleri zamanlama</a> bölümüne bakın.</p> <h3 id="expose-errors"> <a href="#expose-errors" class="anchor-heading" aria-labelledby="expose-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expose errors </h3> <p>Repositorylerle ve veri kaynaklarıyla etkileşimler başarılı olabilir veya bir hata oluştuğunda bir exception fırlatabilir. Coroutine’ler ve flow’lar için <a href="https://kotlinlang.org/docs/exception-handling.html">Kotlin’in yerleşik hata işleme mekanizması</a>nı kullanmalısınız. Suspend fonksiyonları tarafından tetiklenebilecek hatalar için, uygun olduğunda try/catch bloklarını kullanın; ve flow’larda <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html">catch</a> operatörünü kullanın. Bu yaklaşımla, UI katmanının data katmanını çağırırken exception’ları ele alması beklenir.</p> <p>Data katmanı farklı hata türlerini anlayabilir ve işleyebilir ve bunları özel exception’lar (örneğin UserNotAuthenticatedException) kullanarak gösterebilir.</p> <p><mark style="background-color:lightblue">Not: Data katmanı ile etkileşimlerin sonucunu modellemenin bir başka yolu da bir Result sınıfı kullanmaktır. Bu model, sonucun işlenmesinin bir parçası olarak ortaya çıkabilecek hataları ve diğer sinyalleri modeller. Bu modelde, data katmanı T yerine bir Result<T> tipi döndürerek UI'nin belirli senaryolarda oluşabilecek bilinen hatalardan haberdar olmasını sağlar. Bu, [LiveData]gibi uygun exception handling'e sahip olmayan reaktif programlama API'leri için gereklidir. &lt;/mark&gt;</T></mark></p> <p>Coroutine’lerdeki hatalar hakkında daha fazla bilgi edinmek için <a href="https://medium.com/androiddevelopers/exceptions-in-coroutines-ce8da1ec060c">Exceptions in coroutines</a> blog gönderisine bakın.</p> <h3 id="common-tasks"> <a href="#common-tasks" class="anchor-heading" aria-labelledby="common-tasks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common tasks </h3> <p>Aşağıdaki bölümlerde, Android uygulamalarında yaygın olan belirli görevleri gerçekleştirmek için data katmanının nasıl kullanılacağına ve tasarlanacağına dair örnekler sunulmaktadır. Örnekler, kılavuzun önceki bölümlerinde bahsedilen tipik News uygulamasını temel almaktadır.</p> <h3 id="make-a-network-request"> <a href="#make-a-network-request" class="anchor-heading" aria-labelledby="make-a-network-request"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Make a network request </h3> <p>Ağ isteği yapmak, bir Android uygulamasının gerçekleştirebileceği en yaygın görevlerden biridir. News uygulamasının kullanıcıya ağdan alınan en son haberleri sunması gerekir. Bu nedenle, uygulamanın ağ işlemlerini yönetmek için bir veri kaynağı sınıfına ihtiyacı vardır: NewsRemoteDataSource. Bilgileri uygulamanın geri kalanına göstermek için, haber verileri üzerindeki işlemleri gerçekleştiren yeni bir repository oluşturulur: NewsRepository.</p> <p>Gereklilik, kullanıcı ekranı açtığında en son haberlerin her zaman güncellenmesi gerektiğidir. Dolayısıyla, bu UI odaklı(UI-oriented) bir operasyondur.</p> <h3 id="create-the-data-source"> <a href="#create-the-data-source" class="anchor-heading" aria-labelledby="create-the-data-source"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create the data source </h3> <p>Veri kaynağının en son haberleri döndüren bir fonksiyon sunması gerekir: ArticleHeadline instancelarının bir listesi. Veri kaynağının ağdan en son haberleri almak için main-safe bir yol sağlaması gerekir. Bunun için, task’in çalıştırılacağı CoroutineDispatcher ya da Executor’a dependency(bağımlılık) alması gerekir.</p> <p>Bir ağ isteği yapmak, yeni bir fetchLatestNews() metodu tarafından yürütülen tek seferlik bir çağrıdır:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">NewsRemoteDataSource</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">newsApi</span><span class="p">:</span> <span class="nc">NewsApi</span><span class="p">,</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">ioDispatcher</span><span class="p">:</span> <span class="nc">CoroutineDispatcher</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**
     * Fetches the latest news from the network and returns the result.
     * This executes on an IO-optimized thread pool, the function is main-safe.
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">fetchLatestNews</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ArticleHeadline</span><span class="p">&gt;</span> <span class="p">=</span>
    <span class="c1">// Move the execution to an IO-optimized thread since the ApiService</span>
            <span class="c1">// doesn't support coroutines and makes synchronous requests.</span>
            <span class="nf">withContext</span><span class="p">(</span><span class="n">ioDispatcher</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">newsApi</span><span class="p">.</span><span class="nf">fetchLatestNews</span><span class="p">()</span>
            <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Makes news-related network synchronous requests.</span>
<span class="kd">interface</span> <span class="nc">NewsApi</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">fetchLatestNews</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ArticleHeadline</span><span class="p">&gt;</span>
<span class="p">}</span>
</code></pre></div></div> <p>NewsApi interface’i network API client’ının implementasyonunu gizler; interface’in <a href="https://square.github.io/retrofit/">Retrofit</a> veya <a href="https://developer.android.com/reference/java/net/HttpURLConnection">HttpURLConnection</a> tarafından desteklenmesi fark etmez. Interface’lere güvenmek, API implementasyonlarını uygulamanızda değiştirilebilir hale getirir.</p> <p><mark style="background-color: lightblue">Püf Noktası: Interface'lere güvenmek, API implementasyonlarını uygulamanızda değiştirilebilir hale getirir. Ölçeklenebilirlik sağlamanın ve bağımlılıkları daha kolay değiştirmenize izin vermenin yanı sıra, testlere sahte veri kaynağı uygulamaları ekleyebildiğiniz için test edilebilirliği de destekler. </mark></p> <h3 id="create-the-repository"> <a href="#create-the-repository" class="anchor-heading" aria-labelledby="create-the-repository"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create the repository </h3> <p>Bu görev için repository sınıfında ekstra bir mantık gerekmediğinden, NewsRepository network veri kaynağı için bir proxy görevi görür. Bu ekstra soyutlama katmanını eklemenin faydaları <a href="#implement-in-memory-data-caching">in-memory caching</a> bölümünde açıklanmıştır.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// NewsRepository is consumed from other layers of the hierarchy.</span>
<span class="kd">class</span> <span class="nc">NewsRepository</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">newsRemoteDataSource</span><span class="p">:</span> <span class="nc">NewsRemoteDataSource</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">fetchLatestNews</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ArticleHeadline</span><span class="p">&gt;</span> <span class="p">=</span>
            <span class="n">newsRemoteDataSource</span><span class="p">.</span><span class="nf">fetchLatestNews</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div> <p>Repository sınıfını doğrudan UI katmanından nasıl kullanacağınızı öğrenmek için <a href="/docs/app-architecture/guide-to-app-architecture/ui-layer/about-the-ui-layer">UI layer</a> kılavuzuna bakın.</p> <h3 id="implement-in-memory-data-caching"> <a href="#implement-in-memory-data-caching" class="anchor-heading" aria-labelledby="implement-in-memory-data-caching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implement in-memory data caching </h3> <p>News uygulaması için yeni bir gereksinim getirildiğini varsayalım: kullanıcı ekranı açtığında, daha önce bir istek yapılmışsa cache’lenmiş haberler kullanıcıya sunulmalıdır. Aksi takdirde, uygulama en son haberleri almak için bir network isteği yapmalıdır.</p> <p>Yeni gereksinim göz önüne alındığında, uygulama, kullanıcı uygulamayı açık tuttuğu sürece en son haberleri bellekte tutmalıdır. Dolayısıyla, bu app-oriented operation (uygulama odaklı işlem)dur.</p> <h3 id="caches"> <a href="#caches" class="anchor-heading" aria-labelledby="caches"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caches </h3> <p>In-memory data caching (bellek içi veri önbellekleme) ekleyerek kullanıcı uygulamanızdayken verileri koruyabilirsiniz. Cache’ler, bazı bilgileri belirli bir süre boyunca (bu durumda kullanıcı uygulamada olduğu sürece) bellekte saklamak içindir. Cache implementasyonları farklı şekillerde olabilir. Basit bir değiştirilebilir değişkenden, birden fazla thread üzerinde okuma/yazma işlemlerinden koruyan daha sofistike bir sınıfa kadar değişebilir. Kullanım durumuna bağlı olarak, caching repository’de veya veri kaynağı sınıflarında uygulanabilir.</p> <h3 id="cache-the-result-of-the-network-request"> <a href="#cache-the-result-of-the-network-request" class="anchor-heading" aria-labelledby="cache-the-result-of-the-network-request"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Cache the result of the network request </h3> <p>Basitlik açısından NewsRepository, en son haberleri cache’lemek için mutable bir değişken kullanır. Farklı thread’lerden gelen okuma ve yazmaları korumak için bir <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.sync/-mutex/">Mutex</a> kullanılır. Paylaşılan mutable state ve concurrency hakkında daha fazla bilgi edinmek için <a href="https://kotlinlang.org/docs/shared-mutable-state-and-concurrency.html#shared-mutable-state-and-concurrency">Kotlin belgelerine</a> bakın.</p> <p>Aşağıdaki implementasyon, en son haber bilgilerini repository’de bir Mutex ile yazma korumalı bir değişkene cache’ler. Network isteğinin sonucu başarılı olursa, veriler latestNews değişkenine atanır.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">NewsRepository</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">newsRemoteDataSource</span><span class="p">:</span> <span class="nc">NewsRemoteDataSource</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Mutex to make writes to cached values thread-safe.</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">latestNewsMutex</span> <span class="p">=</span> <span class="nc">Mutex</span><span class="p">()</span>

    <span class="c1">// Cache of the latest news got from the network.</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">latestNews</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ArticleHeadline</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">emptyList</span><span class="p">()</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getLatestNews</span><span class="p">(</span><span class="n">refresh</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ArticleHeadline</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">refresh</span> <span class="p">||</span> <span class="n">latestNews</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">networkResult</span> <span class="p">=</span> <span class="n">newsRemoteDataSource</span><span class="p">.</span><span class="nf">fetchLatestNews</span><span class="p">()</span>
            <span class="c1">// Thread-safe write to latestNews</span>
            <span class="n">latestNewsMutex</span><span class="p">.</span><span class="nf">withLock</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">latestNews</span> <span class="p">=</span> <span class="n">networkResult</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">latestNewsMutex</span><span class="p">.</span><span class="nf">withLock</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="n">latestNews</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="make-an-operation-live--longer-than-the-screen"> <a href="#make-an-operation-live--longer-than-the-screen" class="anchor-heading" aria-labelledby="make-an-operation-live--longer-than-the-screen"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Make an operation live longer than the screen </h3> <p>Ağ isteği devam ederken kullanıcı ekrandan uzaklaşırsa, istek iptal edilir ve sonuç cache’lenmez. NewsRepository bu logici gerçekleştirmek için Caller’ın CoroutineScope’unu kullanmamalıdır. Bunun yerine, NewsRepository kendi yaşam döngüsüne bağlı bir CoroutineScope kullanmalıdır. En son haberleri getirmenin app-oriented bir operasyon olması gerekir.</p> <p>Dependency injection best practicelerini takip etmek için NewsRepository kendi CoroutineScope’unu oluşturmak yerine constructor’ında parametre olarak bir scope almalıdır. Repository’lerin işlerinin çoğunu background thread’lerde yapması gerektiğinden, CoroutineScope’u Dispatchers.Default ya da kendi thread havuzunuz ile yapılandırmalısınız.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">NewsRepository</span><span class="p">(</span>
        <span class="o">..</span><span class="p">.,</span>
        <span class="c1">// This could be CoroutineScope(SupervisorJob() + Dispatchers.Default).</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">externalScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span>
<span class="p">)</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>
</code></pre></div></div> <p>NewsRepository harici CoroutineScope ile app oriented operasyonlar gerçekleştirmeye hazır olduğundan, veri kaynağına çağrıyı gerçekleştirmeli ve sonucunu bu scope tarafından başlatılan yeni bir coroutine ile kaydetmelidir:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">NewsRepository</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">newsRemoteDataSource</span><span class="p">:</span> <span class="nc">NewsRemoteDataSource</span><span class="p">,</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">externalScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* ... */</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getLatestNews</span><span class="p">(</span><span class="n">refresh</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ArticleHeadline</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">refresh</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">externalScope</span><span class="p">.</span><span class="nf">async</span> <span class="p">{</span>
                <span class="n">newsRemoteDataSource</span><span class="p">.</span><span class="nf">fetchLatestNews</span><span class="p">().</span><span class="nf">also</span> <span class="p">{</span> <span class="n">networkResult</span> <span class="p">-&gt;</span>
                    <span class="c1">// Thread-safe write to latestNews.</span>
                    <span class="n">latestNewsMutex</span><span class="p">.</span><span class="nf">withLock</span> <span class="p">{</span>
                        <span class="n">latestNews</span> <span class="p">=</span> <span class="n">networkResult</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}.</span><span class="nf">await</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">latestNewsMutex</span><span class="p">.</span><span class="nf">withLock</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="n">latestNews</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>async, coroutine’i harici scope’da başlatmak için kullanılır. await, network isteği geri gelene ve sonuç cache’e kaydedilene kadar askıya almak için yeni coroutine üzerinde çağrılır. O zamana kadar kullanıcı hala ekrandaysa, en son haberleri görecektir; kullanıcı ekrandan uzaklaşırsa, await iptal edilir ancak async içindeki logic çalışmaya devam eder.</p> <p>CoroutineScope patternleri hakkında daha fazla bilgi edinmek için bu <a href="https://medium.com/androiddevelopers/coroutines-patterns-for-work-that-shouldnt-be-cancelled-e26c40f142ad">blog</a> yazısına bakın.</p> <h3 id="save-and-retrieve-data-from-disk"> <a href="#save-and-retrieve-data-from-disk" class="anchor-heading" aria-labelledby="save-and-retrieve-data-from-disk"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Save and retrieve data from disk </h3> <p>Bookmark edilmiş haberler ve kullanıcı tercihleri gibi verileri kaydetmek istediğinizi varsayalım. Bu tür verilerin process death’den kurtulması ve kullanıcı network’e bağlı olmasa bile erişilebilir olması gerekir.</p> <p>Üzerinde çalıştığınız verilerin process death’den kurtulması gerekiyorsa, aşağıdaki yollardan biriyle diskte saklamanız gerekir:</p> <p>-Sorgulanması gereken, referans bütünlüğüne ihtiyaç duyan veya kısmi güncellemelere ihtiyaç duyan büyük veri kümeleri için verileri bir Room veritabanına kaydedin. News uygulaması örneğinde, haber makaleleri veya yazarları veritabanına kaydedilebilir. -Yalnızca alınması ve ayarlanması gereken (sorgulanmayan veya kısmen güncellenmeyen) küçük veri kümeleri için DataStore kullanın. News uygulaması örneğinde, kullanıcının tercih ettiği tarih biçimi veya diğer görüntüleme tercihleri DataStore’a kaydedilebilir. -JSON nesnesi gibi veri parçaları için bir dosya kullanın.</p> <p><a href="about-the-data-layer.md#source-of-truth">Source of truth bölümü</a>nde belirtildiği gibi, her veri kaynağı yalnızca bir kaynakla çalışır ve belirli bir veri türüne karşılık gelir (örneğin, News, Authors, NewsAndAuthors veya UserPreferences). Veri kaynağını kullanan sınıflar, verilerin nasıl kaydedildiğini bilmemelidir (örneğin, bir veritabanına veya bir dosyaya).</p> <h3 id="room-as-a-data-source"> <a href="#room-as-a-data-source" class="anchor-heading" aria-labelledby="room-as-a-data-source"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Room as a data source </h3> <p>Her veri kaynağının belirli bir veri türü için yalnızca bir kaynakla çalışma sorumluluğuna sahip olması gerektiğinden, bir Room veri kaynağı parametre olarak ya bir <a href="https://developer.android.com/training/data-storage/room/accessing-data">veri erişim nesnesi (DAO)</a> ya da veritabanının kendisini alacaktır. Örneğin, NewsLocalDataSource parametre olarak NewsDao’nun bir instance’ını alabilir ve AuthorsLocalDataSource AuthorsDao’nun bir instance’ını alabilir.</p> <p>Bazı durumlarda, ekstra bir lojik gerekmiyorsa, DAO testlerde kolayca değiştirebileceğiniz bir interface olduğundan, DAO’yu doğrudan repository’ye enjekte edebilirsiniz.</p> <p>Room API’leri ile çalışma hakkında daha fazla bilgi edinmek için <a href="https://developer.android.com/training/data-storage/room">Room kılavuzları</a>na bakın.</p> <h3 id="datastore-as-a-data-source"> <a href="#datastore-as-a-data-source" class="anchor-heading" aria-labelledby="datastore-as-a-data-source"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DataStore as a data source </h3> <p><a href="/docs/app-architecture/architecture-components/data-layer-libraries/datastore">DataStore</a>, kullanıcı ayarları gibi key-value çiftlerini saklamak için mükemmeldir. Örnekler arasında zaman biçimi, bildirim tercihleri ve kullanıcı okuduktan sonra haber öğelerinin gösterilip gösterilmeyeceği veya gizlenip gizlenmeyeceği yer alabilir. DataStore aynı zamanda <a href="https://developers.google.com/protocol-buffers">protocol buffer</a>‘ları olan tiplendirilmiş nesneleri de depolayabilir.</p> <p>Diğer tüm nesnelerde olduğu gibi, DataStore tarafından desteklenen bir veri kaynağı, belirli bir türe veya uygulamanın belirli bir bölümüne karşılık gelen verileri içermelidir. Bu durum DataStore için daha da geçerlidir çünkü DataStore okumaları, bir değer her güncellendiğinde yayılan bir akış olarak açığa çıkar. Bu nedenle, ilgili tercihleri aynı DataStore’da saklamalısınız.</p> <p>Örneğin, yalnızca bildirimle ilgili tercihleri işleyen bir NotificationsDataStore’a ve yalnızca haber ekranıyla ilgili tercihleri işleyen bir NewsPreferencesDataStore’a sahip olabilirsiniz. Bu şekilde, newsScreenPreferencesDataStore.data akışı yalnızca o ekranla ilgili bir tercih değiştirildiğinde yayıldığı için güncellemeleri daha iyi kapsamlandırabilirsiniz. Bu aynı zamanda nesnenin yaşam döngüsünün daha kısa olabileceği anlamına gelir çünkü yalnızca haber ekranı görüntülendiği sürece yaşayabilir.</p> <p>DataStore API’leri ile çalışma hakkında daha fazla bilgi edinmek için <a href="/docs/app-architecture/architecture-components/data-layer-libraries/datastore">DataStore kılavuzları</a>na bakın.</p> <h3 id="a-file-as-a-data-source"> <a href="#a-file-as-a-data-source" class="anchor-heading" aria-labelledby="a-file-as-a-data-source"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A file as a data source </h3> <p>JSON nesnesi veya bitmap gibi büyük nesnelerle çalışırken, bir File nesnesiyle çalışmanız ve thread’leri değiştirmeniz gerekir.</p> <p>Storage ile çalışma hakkında daha fazla bilgi edinmek için <a href="/docs/core-topics/app-data-and-files/about-storage">Storage oveview</a> sayfasına bakın.</p> <h3 id="schedule-tasks-using-workmanager"> <a href="#schedule-tasks-using-workmanager" class="anchor-heading" aria-labelledby="schedule-tasks-using-workmanager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Schedule tasks using WorkManager </h3> <p>News uygulaması için yeni bir gereksinim daha getirildiğini varsayalım: Uygulama, kullanıcıya cihaz şarjda olduğu ve kesintisiz bir ağa bağlı olduğu sürece en son haberleri düzenli ve otomatik olarak alma seçeneği sunmalıdır. Bu da bunu business-oriented operation haline getiriyor. Bu gereklilik, kullanıcı uygulamayı açtığında cihazın bağlantısı olmasa bile kullanıcının en son haberleri görebilmesini sağlar.</p> <p><a href="/docs/app-architecture/architecture-components/data-layer-libraries/workmanager/about-workmanager">WorkManager</a>, asenkron ve güvenilir iş planlamayı kolaylaştırır ve kısıtlama yönetimiyle ilgilenebilir. Kalıcı işler için önerilen kütüphanedir. Yukarıda tanımlanan görevi gerçekleştirmek için bir <a href="/docs/core-topics/background-tasks/persistent-work/threading/threading-in-coroutineworker">Worker sınıfı</a> oluşturulur: RefreshLatestNewsWorker. Bu sınıf, en son haberleri getirmek ve diske cache’lemek için NewsRepository’yi dependency olarak alır.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">RefreshLatestNewsWorker</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">newsRepository</span><span class="p">:</span> <span class="nc">NewsRepository</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="nc">WorkerParameters</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">CoroutineWorker</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">doWork</span><span class="p">():</span> <span class="nc">Result</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">newsRepository</span><span class="p">.</span><span class="nf">refreshLatestNews</span><span class="p">()</span>
        <span class="nc">Result</span><span class="p">.</span><span class="nf">success</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Throwable</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Result</span><span class="p">.</span><span class="nf">failure</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Bu tür görevler için business logic kendi sınıfında kapsüllenmeli ve ayrı bir veri kaynağı olarak ele alınmalıdır. WorkManager daha sonra yalnızca tüm kısıtlamalar karşılandığında işin bir background thread üzerinde yürütülmesini sağlamaktan sorumlu olacaktır. Bu kalıba bağlı kalarak, gerektiğinde farklı ortamlardaki uygulamaları hızlı bir şekilde değiştirebilirsiniz.</p> <p>Bu örnekte, haberlerle ilgili bu görev, bağımlılık olarak yeni bir veri kaynağı alacak olan NewsRepository’den çağrılmalıdır: NewsTasksDataSource, aşağıdaki gibi implemente edilmiştir:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">REFRESH_RATE_HOURS</span> <span class="p">=</span> <span class="mi">4L</span>
<span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">FETCH_LATEST_NEWS_TASK</span> <span class="p">=</span> <span class="s">"FetchLatestNewsTask"</span>
<span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">TAG_FETCH_LATEST_NEWS</span> <span class="p">=</span> <span class="s">"FetchLatestNewsTaskTag"</span>

<span class="kd">class</span> <span class="nc">NewsTasksDataSource</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">workManager</span><span class="p">:</span> <span class="nc">WorkManager</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">fetchNewsPeriodically</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">fetchNewsRequest</span> <span class="p">=</span> <span class="nc">PeriodicWorkRequestBuilder</span><span class="p">&lt;</span><span class="nc">RefreshLatestNewsWorker</span><span class="p">&gt;(</span>
            <span class="nc">REFRESH_RATE_HOURS</span><span class="p">,</span> <span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">HOURS</span>
        <span class="p">).</span><span class="nf">setConstraints</span><span class="p">(</span>
            <span class="nc">Constraints</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">setRequiredNetworkType</span><span class="p">(</span><span class="nc">NetworkType</span><span class="p">.</span><span class="nc">TEMPORARILY_UNMETERED</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">setRequiresCharging</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
        <span class="p">)</span>
            <span class="p">.</span><span class="nf">addTag</span><span class="p">(</span><span class="nc">TAG_FETCH_LATEST_NEWS</span><span class="p">)</span>

        <span class="n">workManager</span><span class="p">.</span><span class="nf">enqueueUniquePeriodicWork</span><span class="p">(</span>
            <span class="nc">FETCH_LATEST_NEWS_TASK</span><span class="p">,</span>
            <span class="nc">ExistingPeriodicWorkPolicy</span><span class="p">.</span><span class="nc">KEEP</span><span class="p">,</span>
            <span class="n">fetchNewsRequest</span><span class="p">.</span><span class="nf">build</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">cancelFetchingNewsPeriodically</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">workManager</span><span class="p">.</span><span class="nf">cancelAllWorkByTag</span><span class="p">(</span><span class="nc">TAG_FETCH_LATEST_NEWS</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Bu tür sınıflar sorumlu oldukları verilere göre adlandırılır; örneğin NewsTasksDataSource veya PaymentsTasksDataSource. Belirli bir veri türüyle ilgili tüm görevler aynı sınıfta kapsüllenmelidir.</p> <p>Görevin uygulama başlangıcında tetiklenmesi gerekiyorsa, repository’i bir <a href="https://developer.android.com/reference/kotlin/androidx/startup/Initializer">Initializer</a>‘dan çağıran <a href="/docs/app-architecture/app-startup">App Startup</a> kütüphanesini kullanarak WorkManager isteğini tetiklemeniz önerilir.</p> <p>WorkManager API’leri ile çalışma hakkında daha fazla bilgi edinmek için <a href="/docs/app-architecture/architecture-components/data-layer-libraries/workmanager/about-workmanager">WorkManager kılavuzları</a>na bakın.</p> <h3 id="testing"> <a href="#testing" class="anchor-heading" aria-labelledby="testing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing </h3> <p><a href="/docs/app-architecture/dependency-injection/about-dependency-injection">Dependency injection</a> best practiceleri, uygulamanızı test ederken yardımcı olur. Harici kaynaklarla iletişim kuran sınıflar için interface’lere güvenmek de faydalıdır. Bir birimi test ederken, testi deterministik ve güvenilir hale getirmek için bağımlılıklarının sahte sürümlerini enjekte edebilirsiniz.</p> <h3 id="unit-tests"> <a href="#unit-tests" class="anchor-heading" aria-labelledby="unit-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unit tests </h3> <p>Veri katmanını test ederken <a href="/docs/best-practices/testing/test-apps-on-android">genel test yönergeleri</a> geçerlidir. Birim testleri için, gerektiğinde gerçek nesneler kullanın ve bir dosyadan okuma veya ağdan okuma gibi harici kaynaklara ulaşan bağımlılıkları taklit edin.</p> <h3 id="integration-tests"> <a href="#integration-tests" class="anchor-heading" aria-labelledby="integration-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Integration tests </h3> <p>Harici kaynaklara erişen entegrasyon testleri, gerçek bir cihaz üzerinde çalıştırılmaları gerektiğinden daha az deterministik olma eğilimindedir. Entegrasyon testlerini daha güvenilir hale getirmek için bu testleri kontrollü bir ortamda yürütmeniz önerilir.</p> <p>Room, veritabanları için testlerinizde tamamen kontrol edebileceğiniz bir in-memory database oluşturmanıza olanak tanır. Daha fazla bilgi edinmek için <a href="/docs/core-topics/app-data-and-files/save-data-in-a-local-database/test-and-debug-your-database">Test and debug your database sayfası</a>na bakın.</p> <p>Networking için, <a href="http://wiremock.org/">WireMock</a> veya <a href="https://github.com/square/okhttp/tree/master/mockwebserver">MockWebServer</a> gibi HTTP ve HTTPS çağrılarını taklit etmenize ve isteklerin beklendiği gibi yapıldığını doğrulamanıza olanak tanıyan popüler kütüphaneler vardır.</p> <h3 id="samples"> <a href="#samples" class="anchor-heading" aria-labelledby="samples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://developer.android.com/topic/architecture/data-layer?continue=https%3A%2F%2Fdeveloper.android.com%2Fcourses%2Fpathways%2Fandroid-architecture%23article-https%3A%2F%2Fdeveloper.android.com%2Ftopic%2Farchitecture%2Fdata-layer#samples">Samples</a> </h3> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
